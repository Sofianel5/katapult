{% extends "main/layout.html" %}
{% load static %}
{% block title %}Your ad campaign{% endblock %}
{% block main %}
<div class="full-width center-row-flex">
  <div class="pg-title" style="margin-bottom: 4vh;">
    Your data driven advertisement plan
  </div>
</div>
<div class="space-evenly-row-flex">
    <div class="adspaces-col column-start-flex">
        <div class="hunned-width center-row-flex">
            <div class="infotitle" style="margin: 4vh 0; width:40vw;">
                {% load humanize %}
                Based off of your budget of ${{ budget|floatformat:2|intcomma }}, we identified the best{% if matches|length != 1 %} adspaces{% else %} adspace{% endif %} for you.
            </div>
        </div>
        <div class="gridcontainer">
            {% for match in matches %}
            <div class="adspace column-start-flex" onmouseover="highlightMarker({{ match.pk }})" onmouseout="unhighlightMarker({{ match.pk }})">
                <div style="background-image: url('{{ match.image.url }}');" class="showcase-img"></div>
                <div style="width: 100%" class="column-start-flex">
                    <div style="width: 100%"  class="adspace-title">
                        {{ match.title }}
                    </div>
                    <div style="width: 100%"  class="adspace-cost adspace-title">
                        ${{ match.direct_price|floatformat:2|intcomma }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div style="width: 30vw; height: 100vh">
        <div style="position: fixed; width: 30vw; height: 80vh; bottom: 20;right: 20;">
            <div class="mapholder" id="map" style="width: 30vw; height: 80vh;">

            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block bottomScripts %}
<script>
    var regIcon;
    var largeIcon;
    var markers = {};
    function initMap() {
        center = {{ coordinates.0.coordinates |safe }}
        map = new google.maps.Map(document.getElementById('map'), {
        center: center,
        zoom: 10
        });
        regIcon = {
            url: "https://maps.google.com/mapfiles/ms/micons/blue.png",
            scaledSize: new google.maps.Size(32, 32)
        };
        largeIcon = {
            url: "https://maps.google.com/mapfiles/ms/micons/blue.png",
            scaledSize: new google.maps.Size(48, 48)
        };
        {% for coordinate in coordinates %}
        var marker = new google.maps.Marker({
            position: {{ coordinate.coordinates | safe |escape }},
            map: map,
            icon: regIcon,
        });
        markers['{{ coordinate.match }}'] = marker
        {% endfor %}
    }
    function highlightMarker(id) {
        console.log("highlighting " +id)
        marker = markers[id]
        marker.setIcon(largeIcon)
    }
    function unhighlightMarker(id) {
        console.log("unhighlighting "+id)
        marker = markers[id]
        marker.setIcon(regIcon)
    }
</script>
<script defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWPqLxyV5wfu5STwy70HY0Dx9cL4KXV7I&callback=initMap">
</script>
{% endblock %}
